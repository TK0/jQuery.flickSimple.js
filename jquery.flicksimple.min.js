/**
 * jQuery.flickSimple v1.1.1
 *
 * Copyright (c) 2011 Makog. http://d.hatena.ne.jp/makog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
(function(d){d.flickSimple=function(a,c){this.setup(d(a),c)};d.extend(d.flickSimple.prototype,{elm:null,target:null,snap:"element",ratio:5,duration:600,lock:!1,onChange:null,onResize:null,onAnimationEnd:null,onClick:null,elmWidth:0,page:1,pageWidth:0,pageLength:0,android:!1,webkit:!0,touchable:!0,anc:null,touchhold:!1,startX:null,startY:null,preX:0,currentX:0,flickX:0,nextX:0,setup:function(a,c){var b=this;b.elm=a;b.elm.css({overflow:"hidden"});b.target=c.target||b.elm.find("ul");b.android=c.android===
void 0?navigator.userAgent.indexOf("Android")!==-1:c.android;b.webkit=typeof WebKitTransitionEvent!=="undefined";b.touchable=typeof ontouchstart!=="undefined";if(c.snap!==void 0)b.snap=c.snap;if(c.ratio!==void 0)b.ratio=c.ratio;if(c.duration!==void 0)b.duration=c.duration;if(c.lock!==void 0)b.lock=c.lock;b.onChange=c.onChange;b.onResize=c.onResize;b.onAnimationEnd=c.onAnimationEnd;b.onClick=c.onClick;typeof window.onorientationchange==="object"&&!b.android?d(window).bind("orientationchange",function(){b.updateSize()}):
d(window).bind("resize",function(){b.updateSize()});b.init();b.android||!b.webkit?b.target.css({position:"relative"}):b.target.css({position:"relative",webkitTransition:"none",webkitTransform:"translate3d(0,0,0)"});b.updateSize();b.touchable?b.elm.bind("touchstart",function(a){b.touchstart(a)}).bind("touchmove",function(a){b.touchmove(a)}).bind("touchend",function(a){b.touchend(a)}):(b.elm.bind("mousedown",function(a){b.touchstart(a)}),d("body").bind("mouseup",function(a){b.touchend(a)}).bind("mousemove",
function(a){b.touchmove(a)}));b.target.bind("webkitTransitionEnd",function(a){if(d.isFunction(b.onAnimationEnd))b.onAnimationEnd(a)});return b},nextPage:function(a){return this.goTo(this.page+(a||1))},prevPage:function(a){return this.goTo(this.page-(a||1))},goTo:function(a){return this.move(-((a-1)*this.pageWidth))},move:function(a){a>0?a=0:a<-this.elmWidth&&(a=-this.elmWidth);this.android||!this.webkit?this.target.animate({left:a+"px"}):this.target.css({webkitTransition:"-webkit-transform 0.3s ease-in",
webkitTransform:"translate3d("+a+"px,0,0)"});return this.update(a)},updateSize:function(){var a=typeof window.orientation!=="undefined"?window.orientation===0?"portrait":"landscape":window.innerWidth<window.innerHeight?"portrait":"landscape",c=this.target.find("li");this.elm.removeClass("landscape portrait").addClass(a);this.target.removeClass("landscape portrait").addClass(a);c.removeClass("landscape portrait").addClass(a);var a=this.target.width(),b=this.elm.width();this.elmWidth=a-b;if(this.snap===
"element")this.pageWidth=b;else if(this.snap==="first")this.pageWidth=d(c.get(0)).width();else if(this.snap==="smallest"){var e=0;c.each(function(){var a=d(this).width();if(e>a||e==0)e=a});this.pageWidth=e}else this.pageWidth=isNaN(this.snap)?0:this.snap;this.pageLength=Math.ceil(a/this.pageWidth);if(d.isFunction(this.onResize))this.onResize();this.goTo(this.page);return this},touchstart:function(a){var c=this,b=c.touchable?event.changedTouches[0]:a;c.startX=b.clientX;c.startY=b.clientY;c.touchhold=
!1;a=a.target.tagName==="A"?d(a.target):d(a.target).closest("a");if(a.length>0)c.anc=a;setTimeout(function(){if(c.anc){c.touchhold=!0;var a=c.anc,b=d.data(a.get(0),"flickSimple.link");b&&(a.attr("href",b),setTimeout(function(){a&&a.attr("href","javascript:;")},200))}},600)},touchmove:function(a){(this.android||this.lock)&&a.preventDefault();if(this.startX===null)this.anc=null;else{var a=this.touchable?a.originalEvent.touches[0]:a,c=a.clientX;if(Math.abs(this.startX-c)>16||Math.abs(this.startY-a.clientY)>
16)this.anc=null;this.nextX=(this.currentX||0)+(c-this.startX);this.android||!this.webkit?this.target.css({left:this.nextX+"px"}):this.target.css({webkitTransition:"none",webkitTransform:"translate3d("+this.nextX+"px,0,0)"});this.flickX=this.preX-c;this.preX=c}},touchend:function(a){if(this.startX!==null){this.startY=this.startX=null;if(this.anc&&!this.touchhold){if(d.isFunction(this.onClick))this.onClick(this.anc);var c=this.anc.get(0),b=d.data(c,"flickSimple.link"),c=d.data(c,"flickSimple.target");
if(b)c&&c!=="_self"?(c==="_blank"&&(c=""),window.open(b,c)):location.href=b;a.preventDefault()}this.touchhold=!1;a=this.nextX+this.flickX*-this.ratio;this.pageWidth&&(b=a%this.pageWidth,a-=b<-this.pageWidth/2?b+this.pageWidth:b);a>0?a=0:a<-this.elmWidth&&(a=-this.elmWidth);this.android||!this.webkit?this.target.animate({left:a+"px"},this.duration,function(a,b,c,d,g){return-d*(b/=g)*(b-2)+c}):this.target.css({webkitTransition:"-webkit-transform "+this.duration/1E3+"s ease-out",webkitTransform:"translate3d("+
a+"px,0,0)"});this.update(a)}},update:function(a){if(this.pageWidth)this.page=Math.ceil(a*-1/this.pageWidth)+1;if(this.currentX!==a&&(this.currentX=a,d.isFunction(this.onChange)))this.onChange();return this},no_mousedown:function(a){a.preventDefault()},init:function(){var a=this;a.target.find("a").each(function(){var c=d(this),b=c.attr("href"),e=c.attr("target");b&&b!=="javascript:;"&&d.data(this,"flickSimple.link",b);d.data(this,"flickSimple.target",e||"");c.attr("href","javascript:;").removeAttr("target");
a.touchable||c.unbind("mousedown",a.no_mousedown).bind("mousedown",a.no_mousedown)});a.touchable||a.target.find("img").unbind("mousedown",a.no_mousedown).bind("mousedown",a.no_mousedown);return a}});d.fn.flickSimple=function(a){var c=this;if(typeof a==="string"){var b=Array.prototype.slice.call(arguments,1);this.each(function(){var e=d.data(this,"flickSimple"),f;e&&(d.isFunction(e[a])?f=e[a].apply(e,b):(b.length>0&&(e[a]=b[1]),f=e[a]));f!==e&&(c=f)})}else this.each(function(){var b=d.data(this,"flickSimple");
b?c=b:d.data(this,"flickSimple",new d.flickSimple(this,a||{}))});return c}})(jQuery);